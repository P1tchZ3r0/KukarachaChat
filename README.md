# Kukaracha Messenger


## Возможности

- Сервер принимает несколько TCP-подключений и рассылает сообщения всем клиентам.
- Клиент предоставляет простое GUI на Qt Widgets: ввод адреса сервера, имени пользователя и отправку сообщений.
- Обмен сообщениями в формате JSON, выделенный общий модуль сериализации.
- Системные уведомления о входе и выходе пользователей.
- Администратор может отключать и блокировать пользователей на лету.

## Структура

- `common/` — общие классы: `ChatMessage`, интерфейс `IMessageSerializer`, реализация `JsonMessageSerializer`.
- `server/` — консольное Qt-приложение (`ChatServer`, `ClientConnection`).
- `client/` — GUI-приложение (`ChatClient`, `MainWindow`).

Такое разбиение позволяет переиспользовать код и изолировать ответственность модулей, что соответствует SOLID.

## Сборка

### Через CMake (рекомендуется)

```bash
cd /home/p1tch_z3r0/Projects/Kukaracha
cmake -S . -B build
cmake --build build -j$(nproc)
```

- Сервер: `build/server/KukarachaServer`
- Клиент: `build/client/KukarachaClient`

### Через qmake (альтернативно)

```bash
cd /home/p1tch_z3r0/Projects/Kukaracha
qmake6 Kukaracha.pro   # или qmake, если Qt 6 установлен как qmake
make -j$(nproc)
```

- Сервер: `server/KukarachaServer`
- Клиент: `client/KukarachaClient`

## Запуск сервера

```bash
./KukarachaServer [порт]
```

- Если порт не указан, используется `4242`.
- Файл учётных записей `users.json` лежит рядом с исполняемым файлом сервера.

### Переменные окружения

- `KUKARACHA_ALLOW_AUTO_REGISTER=1` — разрешает автоматическое создание пользователей при первом входе.  
  По умолчанию переменная не задана, и сервер принимает только существующие логины: добавьте пользователя в `users.json` заранее.
- `QT_LOGGING_RULES="kukaracha.server*.debug=true"` — включает подробные сообщения Qt (пример).

#### Пример использования переменной

```bash
# разрешить авто-регистрацию на время запуска
export KUKARACHA_ALLOW_AUTO_REGISTER=1
./KukarachaServer

# выключить
unset KUKARACHA_ALLOW_AUTO_REGISTER
./KukarachaServer
```

### Команды администратора

Учётная запись `admin` обладает особыми правами и может отправлять команды прямо из чата (сообщение начинается с `/`):

- `/kick <логин>` — немедленно отключить указанного пользователя.
- `/ban <логин>` — добавить пользователя в бан-лист и отключить, если он в сети.
- `/unban <логин>` — убрать пользователя из бан-листа.

Блокировка действует до перезапуска сервера. Забаненным логинам соединение отклоняется ещё на этапе авторизации.


## Запуск клиента

```bash
./KukarachaClient
```

Далее в окне клиента укажите хост (IP или домен/DNS), порт, логин и пароль, затем нажмите «Подключиться».

## Проверка

1. Запустите сервер и убедитесь, что в логах появляется сообщение о старте.
2. Запустите несколько клиентов, подключитесь к серверу и отправьте сообщения — они должны отображаться у всех клиентов.

## TODO

- Добавить авторизацию и историю сообщений.
- Вынести протокол в отдельный модуль или заменить на protobuf.
- Реализовать хранение списка пользователей и отображение статуса.

